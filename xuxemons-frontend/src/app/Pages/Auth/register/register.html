<section class="register-page">
  <form class="register-card" [formGroup]="registerForm" (ngSubmit)="onSubmit()" aria-label="Register form">
    <div class="brand">
      <img src="/icons/logo.svg" class="brand-logo" alt="Xuxemons logo" />
      <h1>Join Our Community</h1>
      <p>Create your account and discover catch them all</p>
    </div>

    @if (errorMessage) {
      <p class="error-message" role="alert" aria-live="polite">{{ errorMessage }}</p>
    }

    <div class="form-group">
      <label for="regName" class="label">Name</label>
      <input
        type="text"
        id="regName"
        formControlName="name"
        placeholder="Name"
        class="input"
        [class.input-error]="isFieldInvalid('name')"
        aria-describedby="regName-error"
      />
      @if (isFieldInvalid('name')) {
        <span id="regName-error" class="error-message" aria-live="polite">
          {{ getErrorMessage('name') }}
        </span>
      }
    </div>

    <div class="form-group">
      <label for="regSurname" class="label">Surname</label>
      <input
        type="text"
        id="regSurname"
        formControlName="surname"
        placeholder="Surname"
        class="input"
        [class.input-error]="isFieldInvalid('surname')"
        aria-describedby="regSurname-error"
      />
      @if (isFieldInvalid('surname')) {
        <span id="regSurname-error" class="error-message" aria-live="polite">
          {{ getErrorMessage('surname') }}
        </span>
      }
    </div>

    <div class="form-group">
      <label for="regEmail" class="label">Email</label>
      <input
        type="email"
        id="regEmail"
        formControlName="email"
        placeholder="youremail@address.com"
        class="input"
        [class.input-error]="isFieldInvalid('email')"
        aria-describedby="regEmail-error"
      />
      @if (isFieldInvalid('email')) {
        <span id="regEmail-error" class="error-message" aria-live="polite">
          {{ getErrorMessage('email') }}
        </span>
      }
    </div>

    <div class="form-group">
      <label for="regPassword" class="label">Password</label>
      <div class="password-wrapper">
        <input
          [attr.type]="showPassword ? 'text' : 'password'"
          id="regPassword"
          formControlName="password"
          placeholder="········"
          class="input"
          [class.input-error]="isFieldInvalid('password')"
          aria-describedby="regPassword-error"
        />
        <button type="button" class="toggle-password" tabindex="0" (click)="togglePassword()" [attr.aria-label]="showPassword ? 'Hide password' : 'Show password'">
          @if (showPassword) {
            <i class="bi bi-eye-fill" aria-hidden="true"></i>
          } @else {
            <i class="bi bi-eye-slash-fill" aria-hidden="true"></i>
          }
        </button>
      </div>
      @if (isFieldInvalid('password')) {
        <span id="regPassword-error" class="error-message" aria-live="polite">
          {{ getErrorMessage('password') }}
        </span>
      }
    </div>

    <div class="form-group">
      <label for="regConfirmPassword" class="label">Confirm Password</label>
      <div class="password-wrapper">
        <input
          [attr.type]="showConfirmPassword ? 'text' : 'password'"
          id="regConfirmPassword"
          formControlName="confirmPassword"
          placeholder="········"
          class="input"
          [class.input-error]="isFieldInvalid('confirmPassword') || (registerForm.errors?.['passwordMismatch'] && registerForm.get('confirmPassword')?.touched)"
          aria-describedby="regConfirmPassword-error"
        />
        <button type="button" class="toggle-password" tabindex="0" (click)="toggleConfirmPassword()" [attr.aria-label]="showConfirmPassword ? 'Hide password' : 'Show password'">
          @if (showConfirmPassword) {
            <i class="bi bi-eye-fill" aria-hidden="true"></i>
          } @else {
            <i class="bi bi-eye-slash-fill" aria-hidden="true"></i>
          }
        </button>
      </div>
      @if (isFieldInvalid('confirmPassword') || (registerForm.errors?.['passwordMismatch'] && registerForm.get('confirmPassword')?.touched)) {
        <span id="regConfirmPassword-error" class="error-message" aria-live="polite">
          @if (registerForm.get('confirmPassword')?.errors?.['required']) {
            This field is required
          } @else if (registerForm.errors?.['passwordMismatch']) {
            Passwords mismatch
          }
        </span>
      }
    </div>

    <label class="checkbox-row" [class.checkbox-error]="isFieldInvalid('acceptTerms')">
      <input type="checkbox" formControlName="acceptTerms" id="regAcceptTerms" aria-describedby="regAcceptTerms-error" />
      <span>I accept the <a routerLink="/terms">Terms and Conditions</a> and the <a routerLink="/privacy">Privacy Policy</a></span>
    </label>
    @if (isFieldInvalid('acceptTerms')) {
      <span id="regAcceptTerms-error" class="error-message" aria-live="polite">{{ getErrorMessage('acceptTerms') }}</span>
    }

    <button type="submit" class="btn-primary">Register</button>

    <p class="login-link-text">Already have an account? <a routerLink="/login">Log in</a></p>
  </form>
</section>
